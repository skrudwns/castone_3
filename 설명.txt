=================================================
AI 여행 플래너: 프로젝트 작동 방식 (팀 공유용)
=================================================

[ 1. 프로젝트 개요 ]

이 프로젝트는 Streamlit의 멀티페이지 기능을 사용한 웹 애플리케이션입니다. 메인 기능인 '여행 계획 에이전트'는 LangGraph 기반의 멀티 에이전트 시스템으로 작동합니다.

각 에이전트(정보 수집가, 날씨 분석가, 관광 전문가 등)는 특정 역할을 맡아 대화를 진행하며, '슈퍼바이저' 에이전트가 전체 흐름을 조율합니다.


[ 2. 핵심 대화 흐름 ]

대화는 사용자의 입력을 바탕으로 슈퍼바이저가 다음 행동을 결정하는 방식으로 진행됩니다.

1. (정보 수집) '정보 수집가'가 사용자에게 **(1)목적지**와 **(2)여행 날짜**만 질문합니다.

2. (날씨 조회) 날짜가 확정되면, '날씨 분석가'가 해당 날짜의 날씨를 조회합니다.

3. (날씨 브리핑) '슈퍼바이저'가 사용자에게 **먼저 날씨 정보를 브리핑**합니다.

4. (취향 질문) 슈퍼바이저는 날씨 브리핑 직후, 날씨를 참고하여 **(3)여행 취향** (예: "실내 활동", "산책")을 질문합니다. 이 흐름은 사용자가 날씨를 인지하고 선호도를 결정하도록 유도합니다.

5. (장소 추천) 사용자가 '취향'을 입력하면, '관광 전문가'가 RAG 검색을 통해 관광지를 추천합니다.

6. (식당 추천) 사용자가 "식당"이나 "메뉴"를 언급하면, '식당 전문가'가 RAG 검색을 통해 식당을 추천합니다.


[ 3. 주요 기능 상세 ]

--- 날씨 로직 ---
* 날씨 정보는 **날짜가 입력된 직후**에만 조회됩니다.
* 날씨 정보(예: "맑음", "비")는 RAG 검색 쿼리에 **자동으로 포함되지 않습니다.**
* 대신, 조회된 날씨는 사용자에게 **정보 제공(브리핑) 용도**로만 사용되며, 사용자가 날씨를 보고 직접 결정한 '취향'(예: "실내 활동")이 RAG 검색 쿼리에 사용됩니다.

--- 경로 최적화 로직 ---
* 사용자가 계획에 추가하는 장소는 내부적으로 **'관광지'**와 **'식당'**으로 분리되어 저장됩니다.
* 사용자가 "경로 최적화"를 요청하면, 시스템은 **'관광지' 목록만**을 대상으로 최적 방문 순서를 계산합니다.
* **'식당' 목록은 경로 최적화 계산에서 의도적으로 제외됩니다.** (이유: 점심 식사 장소에서 바로 저녁 식사 장소로 안내하는 비논리적인 경로를 방지하기 위함입니다.)

--- RAG (검색) 로직 ---
* 관광지와 식당 추천은 모두 `review-faiss`라는 로컬 벡터 데이터베이스(FAISS)를 기반으로 한 RAG 검색을 통해 이루어집니다.
* 검색 시, 사용자의 단일 쿼리를 여러 개의 다양한 쿼리로 확장(RAG-Fusion)하여 검색 품질을 높입니다.

--- 리뷰 작성 및 DB 자동 업데이트 (신규 메뉴) ---
* 'Review writer' 메뉴에서 사용자가 직접 방문 후기를 작성할 수 있습니다.
* 제출된 리뷰는 서버에 임시 파일(`new_reviews.csv`)로 차곡차곡 **누적**됩니다.
* 누적된 리뷰가 **10개 이상**이 되는 순간, 업데이트 스크립트가 자동으로 실행됩니다.
* 이 스크립트는 누적된 리뷰들을 전처리(정제, 청킹)하고, 기존 `review-faiss` 벡터 DB에 **추가(업데이트)**한 후 덮어씁니다.
* 업데이트가 완료되면, 앱의 메모리 캐시가 삭제되어 '여행 계획 에이전트'가 다음 검색 시 **최신화된 DB를 사용**하게 됩니다.